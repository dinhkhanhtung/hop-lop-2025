<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ƒêƒÉng k√Ω h·ªçp l·ªõp</title>
  <style>
    :root{
      --green-1:#4CAF50;
      --green-2:#2ecc71;
      --card-bg:#ffffff;
      --rounded:12px;
    }
    body {
      font-family: "Segoe UI", Roboto, Arial, sans-serif;
      margin: 0;
      background: linear-gradient(90deg, #e8f5e9, #f1f8f0);
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      padding: 16px;
    }
    .container {
      width: 100%;
      max-width: 520px;
      background: var(--card-bg);
      border-radius: var(--rounded);
      box-shadow: 0 6px 22px rgba(0,0,0,0.08);
      overflow: hidden;
    }

    /* === D·∫£i m√†u (header gradient) === */
    .header {
      padding: 20px 16px;
      background: linear-gradient(135deg, var(--green-1), var(--green-2));
      color: white;
      text-align: center;
    }
    .header h1 {
      margin: 0;
      font-size: 1.2rem;
      letter-spacing: 0.2px;
    }
    .header p {
      margin: 6px 0 0;
      font-size: 0.9rem;
      opacity: 0.95;
    }

    .content {
      padding: 18px;
    }
    label {
      display: block;
      margin-top: 12px;
      font-weight: 600;
      color: #333;
      font-size: 0.95rem;
    }
    input[type="text"],
    input[type="tel"],
    input[type="number"],
    select,
    textarea {
      width: 100%;
      padding: 10px 12px;
      margin-top: 6px;
      border-radius: 10px;
      border: 1px solid #d4d4d4;
      box-sizing: border-box;
      font-size: 15px;
      background: #fff;
    }
    textarea { resize: vertical; min-height: 80px; }

    .row {
      display: flex;
      gap: 12px;
    }
    .row > * { flex: 1; }

    button {
      margin-top: 16px;
      width: 100%;
      padding: 12px;
      font-size: 16px;
      font-weight: 700;
      background: var(--green-1);
      color: #fff;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    }
    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    #loadingText {
      display: none;
      text-align: center;
      margin-top: 10px;
      font-style: italic;
      color: #2e7d32;
    }

    /* Popup modal */
    .popup {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.45);
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }
    .popup-inner {
      background: #fff;
      padding: 18px 20px;
      border-radius: 12px;
      text-align: center;
      width: min(92%, 360px);
      box-shadow: 0 8px 30px rgba(0,0,0,0.2);
    }
    .popup-inner h3 { margin: 0 0 8px; color: #27ae60; }
    .popup-inner p { margin: 0 0 12px; color: #333; }
    .popup-inner button {
      background: #27ae60;
      color: #fff;
      padding: 10px 14px;
      border-radius: 8px;
      border: none;
      font-weight: 700;
      cursor: pointer;
    }

    @media (max-width:420px){
      .header h1{ font-size: 1.05rem; }
      .content{ padding: 14px; }
    }
  </style>
</head>
<body>

  <div class="container" role="main">
    <!-- Header with gradient (d·∫£i m√†u) -->
    <div class="header" aria-hidden="false">
      <h1>üéì ƒêƒÉng k√Ω h·ªçp l·ªõp ‚Äî 04/10/2025</h1>
      <p>Kh√°ch m·ªùi: C√¥ B·∫±ng, Th·∫ßy C∆∞·ªùng, Th·∫ßy B·∫Øc ‚Äî Vui l√≤ng ƒëi·ªÅn th√¥ng tin</p>
    </div>

    <div class="content">
      <form id="classForm" autocomplete="on">
        <label for="name">H·ªç v√† t√™n *</label>
        <input id="name" name="name" type="text" required placeholder="Nguy·ªÖn VƒÉn A">

        <label for="phone">S·ªë ƒëi·ªán tho·∫°i *</label>
        <!-- type text ƒë·ªÉ gi·ªØ s·ªë 0 ƒë·∫ßu; pattern gi·ªõi h·∫°n 9-11 ch·ªØ s·ªë -->
        <input id="phone" name="phone" type="text" inputmode="numeric" required
               pattern="0?[0-9]{8,10}" placeholder="V√≠ d·ª•: 0912345678">

        <label for="social">Facebook / Zalo (link ho·∫∑c t√™n)</label>
        <input id="social" name="social" type="text" placeholder="https://facebook.com/xxx ho·∫∑c Zalo">

        <label for="location">T·ªânh/Th√†nh *</label>
        <select id="location" name="location" required>
          <option value="">-- Ch·ªçn t·ªânh/th√†nh --</option>
          <option>An Giang</option><option>B√† R·ªãa - V≈©ng T√†u</option><option>B·∫°c Li√™u</option>
          <option>B·∫Øc K·∫°n</option><option>B·∫Øc Giang</option><option>B·∫Øc Ninh</option>
          <option>B·∫øn Tre</option><option>B√¨nh D∆∞∆°ng</option><option>B√¨nh ƒê·ªãnh</option>
          <option>B√¨nh Ph∆∞·ªõc</option><option>B√¨nh Thu·∫≠n</option><option>C√† Mau</option>
          <option>Cao B·∫±ng</option><option>C·∫ßn Th∆°</option><option>ƒê√† N·∫µng</option>
          <option>ƒê·∫Øk L·∫Øk</option><option>ƒê·∫Øk N√¥ng</option><option>ƒêi·ªán Bi√™n</option>
          <option>ƒê·ªìng Nai</option><option>ƒê·ªìng Th√°p</option><option>Gia Lai</option>
          <option>H√† Giang</option><option>H√† Nam</option><option>H√† N·ªôi</option>
          <option>H√† Tƒ©nh</option><option>H·∫£i D∆∞∆°ng</option><option>H·∫£i Ph√≤ng</option>
          <option>H·∫≠u Giang</option><option>H√≤a B√¨nh</option><option>H∆∞ng Y√™n</option>
          <option>Kh√°nh H√≤a</option><option>Ki√™n Giang</option><option>Kon Tum</option>
          <option>Lai Ch√¢u</option><option>L·∫°ng S∆°n</option><option>L√†o Cai</option>
          <option>L√¢m ƒê·ªìng</option><option>Long An</option><option>Nam ƒê·ªãnh</option>
          <option>Ngh·ªá An</option><option>Ninh B√¨nh</option><option>Ninh Thu·∫≠n</option>
          <option>Ph√∫ Th·ªç</option><option>Ph√∫ Y√™n</option><option>Qu·∫£ng B√¨nh</option>
          <option>Qu·∫£ng Nam</option><option>Qu·∫£ng Ng√£i</option><option>Qu·∫£ng Ninh</option>
          <option>Qu·∫£ng Tr·ªã</option><option>S√≥c TrƒÉng</option><option>S∆°n La</option>
          <option>T√¢y Ninh</option><option>Th√°i B√¨nh</option><option>Th√°i Nguy√™n</option>
          <option>Thanh H√≥a</option><option>Th·ª´a Thi√™n Hu·∫ø</option><option>Ti·ªÅn Giang</option>
          <option>TP H·ªì Ch√≠ Minh</option><option>Tr√† Vinh</option><option>Tuy√™n Quang</option>
          <option>Vƒ©nh Long</option><option>Vƒ©nh Ph√∫c</option><option>Y√™n B√°i</option>
        </select>

        <label for="attend">B·∫°n c√≥ tham gia?</label>
        <select id="attend" name="attend">
          <option value="C√≥">C√≥</option>
          <option value="Ch∆∞a ch·∫Øc">Ch∆∞a ch·∫Øc</option>
          <option value="Kh√¥ng">Kh√¥ng</option>
        </select>

        <div class="row">
          <div>
            <label for="companions">S·ªë ng∆∞·ªùi ƒëi c√πng</label>
            <input id="companions" name="companions" type="number" min="0" value="0">
          </div>
          <div>
            <label for="empty">&nbsp;</label>
            <input style="visibility:hidden" aria-hidden="true">
          </div>
        </div>

        <label for="suggestion">G√≥p √Ω / ƒê·ªÅ xu·∫•t</label>
        <textarea id="suggestion" name="suggestion" rows="3" placeholder="VD: mu·ªën t·ªï ch·ª©c ·ªü H√† N·ªôi, ∆∞u ti√™n ƒÉn u·ªëng..."></textarea>

        <button type="submit" id="submitBtn">G·ª≠i th√¥ng tin</button>
        <div id="loadingText">‚è≥ ƒêang g·ª≠i, vui l√≤ng ch·ªù...</div>
      </form>
    </div>
  </div>

  <!-- Popup -->
  <div class="popup" id="popup" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="popup-inner" role="document">
      <h3>‚úÖ ƒê√£ g·ª≠i th√†nh c√¥ng!</h3>
      <p>C·∫£m ∆°n b·∫°n ‚Äî ch√∫ng m√¨nh s·∫Ω g·ªçi x√°c nh·∫≠n ƒë·ªÉ ch·ªët danh s√°ch.</p>
      <button id="closePopupBtn">ƒê√≥ng</button>
    </div>
  </div>

  <script>
    // === Thay b·∫±ng link Web App /exec c·ªßa b·∫°n ===
    const scriptURL = "https://script.google.com/macros/s/AKfycbx6rHxgPTVimX2OaAB442uUHUK_9X2HN0fdhbjKmeogk89h0UJfnS4Gajqt3boo_DFY/exec";

    const form = document.getElementById('classForm');
    const submitBtn = document.getElementById('submitBtn');
    const loadingText = document.getElementById('loadingText');
    const popup = document.getElementById('popup');
    const closePopupBtn = document.getElementById('closePopupBtn');

    // Hi·ªÉn th·ªã popup khi URL c√≥ ?success=1 (ch·ªëng F5 g·ª≠i l·∫°i)
    window.addEventListener('DOMContentLoaded', () => {
      const params = new URLSearchParams(window.location.search);
      if (params.get('success') === '1') {
        showPopup();
        // X√≥a param kh·ªèi URL ƒë·ªÉ F5 kh√¥ng hi·ªán l·∫°i popup
        window.history.replaceState({}, document.title, window.location.pathname);
      }
    });

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      // simple client-side validation for phone pattern
      const phoneInput = document.getElementById('phone');
      const phoneOk = phoneInput.checkValidity();
      if (!phoneOk) {
        alert('Vui l√≤ng nh·∫≠p s·ªë ƒëi·ªán tho·∫°i h·ª£p l·ªá (v√≠ d·ª•: 0912345678).');
        phoneInput.focus();
        return;
      }

      submitBtn.disabled = true;
      loadingText.style.display = 'block';

      try {
        const resp = await fetch(scriptURL, { method: 'POST', body: new FormData(form) });

        // n·∫øu server tr·∫£ ok ‚Üí redirect ƒë·ªÉ tr√°nh re-submit khi F5
        if (resp.ok) {
          // redirect v·ªõi param success ƒë·ªÉ hi·ªán popup 1 l·∫ßn
          window.location.href = window.location.pathname + '?success=1';
        } else {
          // ƒë·ªçc body n·∫øu c√≥ ƒë·ªÉ debug/hi·ªán l·ªói
          const text = await resp.text();
          alert('C√≥ l·ªói khi g·ª≠i d·ªØ li·ªáu. Vui l√≤ng th·ª≠ l·∫°i.\n' + (text || ''));
          submitBtn.disabled = false;
          loadingText.style.display = 'none';
        }
      } catch (err) {
        console.error('Fetch error:', err);
        alert('Kh√¥ng th·ªÉ k·∫øt n·ªëi t·ªõi server. Vui l√≤ng ki·ªÉm tra l·∫°i link Apps Script v√† quy·ªÅn deploy.');
        submitBtn.disabled = false;
        loadingText.style.display = 'none';
      }
    });

    function showPopup() {
      popup.style.display = 'flex';
      popup.setAttribute('aria-hidden', 'false');
    }
    function hidePopup() {
      popup.style.display = 'none';
      popup.setAttribute('aria-hidden', 'true');
    }
    closePopupBtn.addEventListener('click', () => {
      hidePopup();
    });
  </script>
</body>
</html>
